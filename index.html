<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RFCN BBALL Game Manager - Web</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body class="bg-gray-100">
  <div id="root" className="container mx-auto p-4">App failed to load. Check console for errors.</div>
  <script type="text/javascript">
    const App = () => {
      const [players, setPlayers] = React.useState([]);
      const [waitlist, setWaitlist] = React.useState([]);
      const [pausedList, setPausedList] = React.useState([]);
      const [nextTeam, setNextTeam] = React.useState([]);
      const [team1, setTeam1] = React.useState([]);
      const [team2, setTeam2] = React.useState([]);
      const [team3, setTeam3] = React.useState([]);
      const [team4, setTeam4] = React.useState([]);
      const [team1Wins, setTeam1Wins] = React.useState(0);
      const [team3Wins, setTeam3Wins] = React.useState(0);
      const [gameStartedA, setGameStartedA] = React.useState(false);
      const [gameStartedB, setGameStartedB] = React.useState(false);
      const [team1Label, setTeam1Label] = React.useState("Team 1");
      const [team2Label, setTeam2Label] = React.useState("Team 2");
      const [team3Label, setTeam3Label] = React.useState("Team 3");
      const [team4Label, setTeam4Label] = React.useState("Team 4");
      const [playerName, setPlayerName] = React.useState("");
      const [signupError, setSignupError] = React.useState(null);
      const [loading, setLoading] = React.useState(true);
      const [error, setError] = React.useState(null);
      const [maxWinsLimit, setMaxWinsLimit] = React.useState(5);
      const [maxWinsInput, setMaxWinsInput] = React.useState("");
      const [maxWinsError, setMaxWinsError] = React.useState(null);
      const [gameMode, setGameMode] = React.useState("5x5");
      const [lastWinnerCourtA, setLastWinnerCourtA] = React.useState(null);

      React.useEffect(() => {
        try {
          const savedState = localStorage.getItem("bballManagerState");
          if (savedState) {
            const state = JSON.parse(savedState);
            setPlayers(state.players || []);
            setWaitlist(state.waitlist || []);
            setPausedList(state.pausedList || []);
            setNextTeam(state.nextTeam || []);
            setTeam1(state.team1 || []);
            setTeam2(state.team2 || []);
            setTeam3(state.team3 || []);
            setTeam4(state.team4 || []);
            setTeam1Wins(state.team1Wins || 0);
            setTeam3Wins(state.team3Wins || 0);
            setGameStartedA(state.gameStartedA || false);
            setGameStartedB(state.gameStartedB || false);
            setTeam1Label(state.team1Label || "Team 1");
            setTeam2Label(state.team2Label || "Team 2");
            setTeam3Label(state.team3Label || "Team 3");
            setTeam4Label(state.team4Label || "Team 4");
            setMaxWinsLimit(state.maxWinsLimit || 5);
            setGameMode(state.gameMode || "5x5");
            setLastWinnerCourtA(state.lastWinnerCourtA || null);
          }
          setLoading(false);
        } catch (err) {
          setError("Failed to load data. Please refresh.");
          setLoading(false);
        }
      }, []);

      React.useEffect(() => {
        try {
          const state = { players, waitlist, pausedList, nextTeam, team1, team2, team3, team4, team1Wins, team3Wins, gameStartedA, gameStartedB, team1Label, team2Label, team3Label, team4Label, maxWinsLimit, gameMode, lastWinnerCourtA };
          localStorage.setItem("bballManagerState", JSON.stringify(state));
        } catch (err) {
          setError("Failed to save data. Check local storage settings.");
        }
      }, [players, waitlist, pausedList, nextTeam, team1, team2, team3, team4, team1Wins, team3Wins, gameStartedA, gameStartedB, team1Label, team2Label, team3Label, team4Label, maxWinsLimit, gameMode, lastWinnerCourtA]);

      const totalCount = team1.length + team2.length + team3.length + team4.length + nextTeam.length + waitlist.length + pausedList.length;

      React.useEffect(() => {
        if (totalCount < 16 && totalCount >= 10 && gameMode === "4x4") {
          setGameMode("5x5");
          setTeam3([]);
          setTeam4([]);
          setTeam3Wins(0);
          setGameStartedB(false);
          setTeam3Label("Team 3");
          setTeam4Label("Team 4");
          setLastWinnerCourtA(null);
          console.log("Auto-switched to 5x5 mode due to insufficient players (< 16).");
        }
      }, [totalCount, gameMode]);

      const addPlayer = () => {
        console.log("addPlayer called with name:", playerName);
        const name = playerName.trim();
        if (!name) {
          setSignupError("Please enter a valid name.");
          console.log("addPlayer: Empty name entered.");
          return;
        }
        const isDuplicate = players.some(p => p.name.toLowerCase() === name.toLowerCase());
        console.log("addPlayer: Duplicate check for", name, "result:", isDuplicate, "existing names:", players.map(p => p.name));
        if (isDuplicate) {
          setSignupError("Player name already exists.");
          return;
        }
        const newPlayer = { id: Date.now().toString(), name, wins: 0, losses: 0, winStreak: 0 };
        setPlayers([...players, newPlayer]);
        setWaitlist([...waitlist, newPlayer.id]);
        setPlayerName("");
        setSignupError(null);
        fillNextTeam([...waitlist, newPlayer.id], nextTeam);
        console.log("addPlayer: Added player", name, "ID:", newPlayer.id);
      };

      const pausePlayer = (id) => {
        setWaitlist(waitlist.filter(pid => pid !== id));
        setPausedList([...pausedList, id]);
        fillNextTeam(waitlist.filter(pid => pid !== id), nextTeam);
      };

      const readyPlayer = (id) => {
        setPausedList(pausedList.filter(pid => pid !== id));
        setWaitlist([...waitlist, id]);
        fillNextTeam([...waitlist, id], nextTeam);
      };

      const removePlayer = (id) => {
        setWaitlist(waitlist.filter(pid => pid !== id));
        setPausedList(pausedList.filter(pid => pid !== id));
        setNextTeam(nextTeam.filter(pid => pid !== id));
        setTeam1(team1.filter(pid => pid !== id));
        setTeam2(team2.filter(pid => pid !== id));
        setTeam3(team3.filter(pid => pid !== id));
        setTeam4(team4.filter(pid => pid !== id));
        setPlayers(players.filter(p => p.id !== id));
        fillNextTeam(waitlist.filter(pid => pid !== id), nextTeam);
      };

      const removeFromNextTeam = (id) => {
        setNextTeam(nextTeam.filter(pid => pid !== id));
        setWaitlist([...waitlist, id]);
        fillNextTeam([...waitlist, id], nextTeam);
      };

      const getTeamSize = () => {
        switch (gameMode) {
          case "5x5": return 5;
          case "4x4": return 4;
          case "3x3": return 3; // Placeholder
          default: return 5;
        }
      };

      const shuffleArray = (array) => {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
      };

      const fillNextTeam = (newWaitlist, currentNextTeam) => {
        if (gameMode === "3x3") {
          console.log(`fillNextTeam: ${gameMode} mode not implemented yet.`);
          return;
        }
        const teamSize = getTeamSize();
        console.log("fillNextTeam called with waitlist:", newWaitlist.map(id => getPlayerName(id)), "nextTeam:", currentNextTeam.map(id => getPlayerName(id)));
        let updatedNextTeam = [...currentNextTeam];
        let updatedWaitlist = [...newWaitlist];
        let playersToAdd = [];
        while (updatedNextTeam.length < teamSize && updatedWaitlist.length > 0 && playersToAdd.length < (teamSize - updatedNextTeam.length)) {
          const nextPlayerId = updatedWaitlist[0];
          if (!playersToAdd.includes(nextPlayerId)) {
            playersToAdd.push(nextPlayerId);
            updatedWaitlist = updatedWaitlist.slice(1);
          } else {
            break; // Avoid duplicates
          }
        }
        updatedNextTeam = [...updatedNextTeam, ...playersToAdd];
        setWaitlist(updatedWaitlist);
        setNextTeam(updatedNextTeam);
        console.log("fillNextTeam updated waitlist:", updatedWaitlist.map(id => getPlayerName(id)), "nextTeam:", updatedNextTeam.map(id => getPlayerName(id)));
      };

      const startFirstGame = (court) => {
        if (gameMode === "3x3") {
          alert(`${gameMode} mode not implemented yet.`);
          return;
        }
        const teamSize = getTeamSize();
        const minPlayers = gameMode === "5x5" ? teamSize * 2 : teamSize * 2; // 10 for 5x5, 8 for 4x4
        if (totalCount < minPlayers) {
          alert(`Need at least ${minPlayers} players for ${gameMode} mode on ${court}.`);
          return;
        }
        if (nextTeam.length < teamSize || waitlist.length < teamSize) {
          alert(`Need at least ${teamSize} players on Next Team and ${teamSize} on waitlist for ${court}.`);
          return;
        }
        console.log(`startFirstGame ${court}: Initial waitlist:`, waitlist.map(id => getPlayerName(id)), 
                    "Next Team:", nextTeam.map(id => getPlayerName(id)));

        if (gameMode === "4x4" && court === "A" && !gameStartedA && !gameStartedB) {
          // 4x4-Fresh: No games started
          const minPlayersBothCourts = teamSize * 4; // 16 for 4x4
          if (totalCount >= minPlayersBothCourts) {
            // Both courts
            setGameStartedA(true);
            setGameStartedB(true);
            const newTeam1 = [...nextTeam].slice(0, teamSize);
            let remainingNextTeam = nextTeam.slice(teamSize);
            let newWaitlist = [...waitlist];
            const newTeam2 = newWaitlist.slice(0, teamSize);
            newWaitlist = newWaitlist.slice(teamSize);
            const newTeam3 = remainingNextTeam.length >= teamSize ? remainingNextTeam.slice(0, teamSize) : [...remainingNextTeam, ...newWaitlist.slice(0, teamSize - remainingNextTeam.length)];
            newWaitlist = newWaitlist.slice(teamSize - remainingNextTeam.length);
            const newTeam4 = newWaitlist.slice(0, teamSize);
            newWaitlist = newWaitlist.slice(teamSize);

            console.log("4x4-Fresh Both Courts: Team 1:", newTeam1.map(id => getPlayerName(id)), 
                        "Team 2:", newTeam2.map(id => getPlayerName(id)), 
                        "Team 3:", newTeam3.map(id => getPlayerName(id)), 
                        "Team 4:", newTeam4.map(id => getPlayerName(id)), 
                        "Remaining waitlist:", newWaitlist.map(id => getPlayerName(id)));

            setTeam1(newTeam1);
            setTeam2(newTeam2);
            setTeam3(newTeam3);
            setTeam4(newTeam4);
            setWaitlist(newWaitlist);
            setNextTeam([]);
            setTeam1Label("Team 1");
            setTeam2Label("Team 2");
            setTeam3Label("Team 3");
            setTeam4Label("Team 4");
            fillNextTeam(newWaitlist, []);
          } else {
            // Only Court A
            setGameStartedA(true);
            const newTeam1 = [...nextTeam].slice(0, teamSize);
            const newTeam2 = waitlist.slice(0, teamSize);
            const remainingWaitlist = waitlist.slice(teamSize);

            console.log("4x4-Fresh Court A: Team 1:", newTeam1.map(id => getPlayerName(id)), 
                        "Team 2:", newTeam2.map(id => getPlayerName(id)), 
                        "Remaining waitlist:", remainingWaitlist.map(id => getPlayerName(id)));

            setTeam1(newTeam1);
            setTeam2(newTeam2);
            setWaitlist(remainingWaitlist);
            setNextTeam([]);
            setTeam1Label("Team 1");
            setTeam2Label("Team 2");
            fillNextTeam(remainingWaitlist, []);
          }
        } else if (gameMode === "5x5" && court === "A") {
          setGameStartedA(true);
          const newTeam1 = [...nextTeam].slice(0, teamSize);
          const newTeam2 = waitlist.slice(0, teamSize);
          const remainingWaitlist = waitlist.slice(teamSize);

          console.log("startFirstGame Court A (5x5): Team 1:", newTeam1.map(id => getPlayerName(id)), 
                      "Team 2:", newTeam2.map(id => getPlayerName(id)), 
                      "Remaining waitlist:", remainingWaitlist.map(id => getPlayerName(id)));

          setTeam1(newTeam1);
          setTeam2(newTeam2);
          setWaitlist(remainingWaitlist);
          setNextTeam([]);
          setTeam1Label("Team 1");
          setTeam2Label("Team 2");
          fillNextTeam(remainingWaitlist, []);
        } else if (gameMode === "4x4" && court === "B" && !gameStartedB && totalCount >= teamSize * 4) {
          setGameStartedB(true);
          const newTeam3 = [...nextTeam].slice(0, teamSize);
          const newTeam4 = waitlist.slice(0, teamSize);
          const remainingWaitlist = waitlist.slice(teamSize);

          console.log("startFirstGame Court B (4x4): Team 3:", newTeam3.map(id => getPlayerName(id)), 
                      "Team 4:", newTeam4.map(id => getPlayerName(id)), 
                      "Remaining waitlist:", remainingWaitlist.map(id => getPlayerName(id)));

          setTeam3(newTeam3);
          setTeam4(newTeam4);
          setWaitlist(remainingWaitlist);
          setNextTeam([]);
          setTeam3Label("Team 3");
          setTeam4Label("Team 4");
          fillNextTeam(remainingWaitlist, []);
        } else {
          alert(`Cannot start game on ${court}. Check game mode and active games.`);
        }
      };

      const startNextGame = (court) => {
        if (gameMode === "3x3") {
          alert(`${gameMode} mode not implemented yet.`);
          return;
        }
        const teamSize = getTeamSize();
        const minPlayers = gameMode === "5x5" ? teamSize * 2 : teamSize * 4;
        if (totalCount < minPlayers) {
          alert(`Need at least ${minPlayers} players for ${gameMode} mode.`);
          return;
        }
        if (nextTeam.length < teamSize) {
          alert(`Not enough players in Next Team (need ${teamSize}) for ${court}.`);
          return;
        }
        console.log(`startNextGame ${court}: Next Team:`, nextTeam.map(id => getPlayerName(id)));
        if (court === "A") {
          setTeam2(nextTeam);
          setNextTeam([]);
          setTeam2Label("Team 2 (Challengers)");
          setTeam1Label("Team 1 (Winners)");
          fillNextTeam(waitlist, []);
        } else if (court === "B") {
          setTeam4(nextTeam);
          setNextTeam([]);
          setTeam4Label("Team 4 (Challengers)");
          setTeam3Label("Team 3 (Winners)");
          fillNextTeam(waitlist, []);
        }
      };

      const declareWinner = (court, winner) => {
        if (gameMode === "3x3") {
          alert(`${gameMode} mode not implemented yet.`);
          return;
        }
        const teamSize = getTeamSize();
        console.log(`declareWinner called for ${winner} on ${court}. Current waitlist:`, waitlist.map(id => getPlayerName(id)));
        let winners, losers, newTeam1, newTeam3, newTeam1Wins, newTeam3Wins, newTeam1Label, newTeam2Label, newTeam3Label, newTeam4Label;

        if (court === "A") {
          if (winner === "Team 1") {
            winners = team1;
            losers = team2;
            newTeam1 = team1;
            newTeam1Wins = team1Wins + 1;
            newTeam1Label = "Team 1 (Winners)";
            newTeam2Label = "Team 2";
          } else {
            winners = team2;
            losers = team1;
            newTeam1 = team2;
            newTeam1Wins = 1;
            newTeam1Label = "Team 1 (Winners)";
            newTeam2Label = "Team 2";
          }
          setLastWinnerCourtA(winners);
        } else if (court === "B") {
          if (winner === "Team 3") {
            winners = team3;
            losers = team4;
            newTeam3 = team3;
            newTeam3Wins = team3Wins + 1;
            newTeam3Label = "Team 3 (Winners)";
            newTeam4Label = "Team 4";
          } else {
            winners = team4;
            losers = team3;
            newTeam3 = team4;
            newTeam3Wins = 1;
            newTeam3Label = "Team 3 (Winners)";
            newTeam4Label = "Team 4";
          }
        }

        setPlayers(players.map(p => {
          if (winners.includes(p.id)) {
            return { ...p, wins: p.wins + 1, winStreak: p.winStreak + 1 };
          }
          if (losers.includes(p.id)) {
            return { ...p, losses: p.losses + 1, winStreak: 0 };
          }
          return p;
        }));

        const shuffledLosers = [...losers].sort(() => Math.random() - 0.5);
        let newWaitlist = [...waitlist, ...shuffledLosers];
        console.log("New waitlist after adding losers:", newWaitlist.map(id => getPlayerName(id)));

        if ((court === "A" && newTeam1Wins >= maxWinsLimit) || (court === "B" && newTeam3Wins >= maxWinsLimit)) {
          console.log("Max-out triggered on", court, "waitlist:", newWaitlist.map(id => getPlayerName(id)), "nextTeam:", nextTeam.map(id => getPlayerName(id)));
          if (court === "A") {
            newWaitlist = [...newWaitlist, ...newTeam1];
            let newTeam1Players = [...nextTeam];
            const remainingSlots = teamSize - newTeam1Players.length;
            if (remainingSlots > 0 && newWaitlist.length >= remainingSlots) {
              newTeam1Players = [...newTeam1Players, ...newWaitlist.slice(0, remainingSlots)];
              newWaitlist = newWaitlist.slice(remainingSlots);
            }
            let newTeam2Players = newWaitlist.slice(0, teamSize);

            if (newTeam1Players.length < teamSize || newTeam2Players.length < teamSize) {
              alert("Not enough players to form new teams after max-out on Court A.");
              setWaitlist([...newWaitlist, ...nextTeam]);
              setTeam1([]);
              setTeam2([]);
              setNextTeam([]);
              setTeam1Wins(0);
              setTeam1Label("Team 1");
              setTeam2Label("Team 2");
              setLastWinnerCourtA(null);
              return;
            }

            newWaitlist = newWaitlist.slice(teamSize);
            newWaitlist = newWaitlist.filter(id => !newTeam1Players.includes(id));

            setTeam1(newTeam1Players);
            setTeam2(newTeam2Players);
            setNextTeam([]);
            setWaitlist(newWaitlist);
            setTeam1Wins(0);
            setTeam1Label("Team 1 (Replacements)");
            setTeam2Label("Team 2 (Hopefuls)");
            setLastWinnerCourtA(null);
            fillNextTeam(newWaitlist, []);
            console.log("After max-out Court A: Team1:", newTeam1Players.map(id => getPlayerName(id)), 
                        "Team2:", newTeam2Players.map(id => getPlayerName(id)), 
                        "Waitlist:", newWaitlist.map(id => getPlayerName(id)));
          } else if (court === "B") {
            newWaitlist = [...newWaitlist, ...newTeam3];
            let newTeam3Players = [...nextTeam];
            const remainingSlots = teamSize - newTeam3Players.length;
            if (remainingSlots > 0 && newWaitlist.length >= remainingSlots) {
              newTeam3Players = [...newTeam3Players, ...newWaitlist.slice(0, remainingSlots)];
              newWaitlist = newWaitlist.slice(remainingSlots);
            }
            let newTeam4Players = newWaitlist.slice(0, teamSize);

            if (newTeam3Players.length < teamSize || newTeam4Players.length < teamSize) {
              alert("Not enough players to form new teams after max-out on Court B.");
              setWaitlist([...newWaitlist, ...nextTeam]);
              setTeam3([]);
              setTeam4([]);
              setNextTeam([]);
              setTeam3Wins(0);
              setTeam3Label("Team 3");
              setTeam4Label("Team 4");
              return;
            }

            newWaitlist = newWaitlist.slice(teamSize);
            newWaitlist = newWaitlist.filter(id => !newTeam3Players.includes(id));

            setTeam3(newTeam3Players);
            setTeam4(newTeam4Players);
            setNextTeam([]);
            setWaitlist(newWaitlist);
            setTeam3Wins(0);
            setTeam3Label("Team 3 (Replacements)");
            setTeam4Label("Team 4 (Hopefuls)");
            fillNextTeam(newWaitlist, []);
            console.log("After max-out Court B: Team3:", newTeam3Players.map(id => getPlayerName(id)), 
                        "Team4:", newTeam4Players.map(id => getPlayerName(id)), 
                        "Waitlist:", newWaitlist.map(id => getPlayerName(id)));
          }
        } else {
          if (court === "A") {
            setTeam1(newTeam1);
            setTeam2([]);
            setWaitlist(newWaitlist);
            setTeam1Wins(newTeam1Wins);
            setTeam1Label(newTeam1Label);
            setTeam2Label(newTeam2Label);
            fillNextTeam(newWaitlist, nextTeam);
          } else if (court === "B") {
            setTeam3(newTeam3);
            setTeam4([]);
            setWaitlist(newWaitlist);
            setTeam3Wins(newTeam3Wins);
            setTeam3Label(newTeam3Label);
            setTeam4Label(newTeam4Label);
            fillNextTeam(newWaitlist, nextTeam);
          }
        }
      };

      const setMaxWins = () => {
        const value = parseInt(maxWinsInput, 10);
        if (isNaN(value) || value <= 0) {
          setMaxWinsError("Please enter a positive number.");
          return;
        }
        setMaxWinsLimit(value);
        setMaxWinsInput("");
        setMaxWinsError(null);
        console.log("Max wins limit set to:", value);
      };

      const handleGameModeChange = (e) => {
        const newMode = e.target.value;
        const teamSize = newMode === "5x5" ? 5 : 4;
        const minPlayers = newMode === "5x5" ? 10 : 8;
        const minPlayersBothCourts = newMode === "4x4" ? 16 : 10;

        if (newMode === "3x3") {
          alert("3x3 mode not implemented yet.");
          return;
        }

        if (totalCount < minPlayers) {
          alert(`Need at least ${minPlayers} players for ${newMode} mode.`);
          return;
        }

        if (newMode === "4x4" && gameMode === "5x5" && gameStartedA && lastWinnerCourtA && totalCount >= minPlayersBothCourts) {
          // 4x4-Split: Switching from 5x5 after a winner on Court A
          console.log("Initiating 4x4-Split with winners:", lastWinnerCourtA.map(id => getPlayerName(id)));
          const winners = shuffleArray([...lastWinnerCourtA]);
          const team1Winners = winners.slice(0, 3); // 3 winners for Team 1
          const team3Winners = winners.slice(3, 5); // 2 winners for Team 3
          let remainingNextTeam = [...nextTeam];
          let newWaitlist = [...waitlist];

          // Team 1: 3 winners + 1 from Next Team
          let newTeam1 = [...team1Winners];
          if (remainingNextTeam.length >= 1) {
            newTeam1.push(remainingNextTeam[0]);
            remainingNextTeam = remainingNextTeam.slice(1);
          } else if (newWaitlist.length >= 1) {
            newTeam1.push(newWaitlist[0]);
            newWaitlist = newWaitlist.slice(1);
          } else {
            alert("Not enough players to form Team 1 in 4x4-Split.");
            return;
          }

          // Team 3: 2 winners + 2 from Next Team
          let newTeam3 = [...team3Winners];
          if (remainingNextTeam.length >= 2) {
            newTeam3.push(...remainingNextTeam.slice(0, 2));
            remainingNextTeam = remainingNextTeam.slice(2);
          } else if (remainingNextTeam.length === 1 && newWaitlist.length >= 1) {
            newTeam3.push(remainingNextTeam[0], newWaitlist[0]);
            remainingNextTeam = remainingNextTeam.slice(1);
            newWaitlist = newWaitlist.slice(1);
          } else if (newWaitlist.length >= 2) {
            newTeam3.push(...newWaitlist.slice(0, 2));
            newWaitlist = newWaitlist.slice(2);
          } else {
            alert("Not enough players to form Team 3 in 4x4-Split.");
            return;
          }

          // Team 2: 4 players from remaining Next Team and Waitlist
          let newTeam2 = [];
          const team2Slots = 4 - newTeam2.length;
          if (remainingNextTeam.length >= team2Slots) {
            newTeam2 = remainingNextTeam.slice(0, team2Slots);
            remainingNextTeam = remainingNextTeam.slice(team2Slots);
          } else {
            newTeam2 = [...remainingNextTeam, ...newWaitlist.slice(0, team2Slots - remainingNextTeam.length)];
            newWaitlist = newWaitlist.slice(team2Slots - remainingNextTeam.length);
            remainingNextTeam = [];
          }

          // Team 4: 4 players from Waitlist
          let newTeam4 = [];
          if (newWaitlist.length >= 4) {
            newTeam4 = newWaitlist.slice(0, 4);
            newWaitlist = newWaitlist.slice(4);
          } else {
            alert("Not enough players to form Team 4 in 4x4-Split.");
            return;
          }

          console.log("4x4-Split: Team 1:", newTeam1.map(id => getPlayerName(id)), 
                      "Team 2:", newTeam2.map(id => getPlayerName(id)), 
                      "Team 3:", newTeam3.map(id => getPlayerName(id)), 
                      "Team 4:", newTeam4.map(id => getPlayerName(id)), 
                      "Remaining waitlist:", newWaitlist.map(id => getPlayerName(id)));

          setGameMode(newMode);
          setGameStartedA(true);
          setGameStartedB(true);
          setTeam1(newTeam1);
          setTeam2(newTeam2);
          setTeam3(newTeam3);
          setTeam4(newTeam4);
          setWaitlist(newWaitlist);
          setNextTeam([]);
          setTeam1Wins(0);
          setTeam3Wins(0);
          setTeam1Label("Team 1");
          setTeam2Label("Team 2");
          setTeam3Label("Team 3");
          setTeam4Label("Team 4");
          setLastWinnerCourtA(null);
          fillNextTeam(newWaitlist, []);
        } else if (newMode === "4x4" && (!gameStartedA && !gameStartedB && totalCount >= minPlayers)) {
          // Allow 4x4-Fresh if no games are active
          setGameMode(newMode);
          console.log("Game mode changed to 4x4-Fresh.");
        } else if (newMode === "5x5") {
          setGameMode(newMode);
          setTeam3([]);
          setTeam4([]);
          setTeam3Wins(0);
          setGameStartedB(false);
          setTeam3Label("Team 3");
          setTeam4Label("Team 4");
          setLastWinnerCourtA(null);
          console.log("Game mode changed to 5x5.");
        } else {
          alert(`Cannot switch to ${newMode} mode. Ensure sufficient players or no conflicting games.`);
        }
      };

      const clearAll = () => {
        setPlayers([]);
        setWaitlist([]);
        setPausedList([]);
        setNextTeam([]);
        setTeam1([]);
        setTeam2([]);
        setTeam3([]);
        setTeam4([]);
        setTeam1Wins(0);
        setTeam3Wins(0);
        setGameStartedA(false);
        setGameStartedB(false);
        setTeam1Label("Team 1");
        setTeam2Label("Team 2");
        setTeam3Label("Team 3");
        setTeam4Label("Team 4");
        setError(null);
        setSignupError(null);
        setMaxWinsLimit(5);
        setMaxWinsInput("");
        setMaxWinsError(null);
        setGameMode("5x5");
        setLastWinnerCourtA(null);
      };

      const clearScores = () => {
        setPlayers(players.map(p => ({ ...p, wins: 0, losses: 0, winStreak: 0 })));
      };

      const getPlayerName = (id) => players.find(p => p.id === id)?.name || "";
      const maxWins = Math.max(...players.map(p => p.wins), 0);
      const waitlistCount = new Set([...waitlist, ...nextTeam]).size;
      const pausedCount = pausedList.length;

      if (loading) {
        return React.createElement("div", { className: "text-center text-xl" }, "Loading...");
      }

      if (error) {
        return React.createElement("div", { className: "text-center text-red-500" },
                      React.createElement("p", null, error),
                      React.createElement("button", {
                        onClick: () => window.location.reload(),
                        className: "mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                      }, "Try Again")
                    );
      }

      return React.createElement("div", { className: "space-y-6" },
        React.createElement("h1", { className: "text-3xl font-bold text-center" }, "RFCN BBALL Game Manager"),
        React.createElement("div", { className: "flex justify-around bg-white p-4 rounded shadow" },
          React.createElement("span", { className: "font-semibold" }, `Total #: ${totalCount}`),
          React.createElement("span", { className: "font-semibold" }, `Waitlist #: ${waitlistCount}`),
          React.createElement("span", { className: "font-semibold" }, `Paused #: ${pausedCount}`)
        ),
        React.createElement("div", { className: "bg-white p-4 rounded shadow" },
          React.createElement("h2", { className: "text-xl font-semibold mb-2" }, "Player Signup"),
          React.createElement("div", { className: "flex flex-col space-y-2" },
            React.createElement("div", { className: "flex space-x-2" },
              React.createElement("input", {
                type: "text",
                value: playerName,
                onChange: (e) => { setPlayerName(e.target.value); setSignupError(null); },
                placeholder: "Enter player name",
                className: "flex-1 p-2 border rounded"
              }),
              React.createElement("button", {
                onClick: addPlayer,
                className: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
              }, "Sign Up")
            ),
            signupError && React.createElement("p", { className: "text-red-500 text-sm" }, signupError)
          )
        ),
        React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-4" },
          React.createElement("div", { className: "bg-white p-4 rounded shadow" },
            React.createElement("h2", { className: "text-xl font-semibold mb-2" }, "Waitlist"),
            React.createElement("ul", { className: "space-y-2" },
              waitlist.map(id => React.createElement("li", { key: id, className: "flex justify-between items-center" },
                React.createElement("span", null, getPlayerName(id)),
                React.createElement("div", { className: "space-x-2" },
                  React.createElement("button", { onClick: () => pausePlayer(id), className: "bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600" }, "Pause"),
                  React.createElement("button", { onClick: () => removePlayer(id), className: "bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600" }, "Remove")
                )
              ))
            )
          ),
          React.createElement("div", { className: "bg-white p-4 rounded shadow" },
            React.createElement("h2", { className: "text-xl font-semibold mb-2" }, "Paused List"),
            React.createElement("ul", { className: "space-y-2" },
              pausedList.map(id => React.createElement("li", { key: id, className: "flex justify-between items-center" },
                React.createElement("span", null, getPlayerName(id)),
                React.createElement("button", { onClick: () => readyPlayer(id), className: "bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600" }, "Ready")
              ))
            )
          ),
          React.createElement("div", { className: "bg-white p-4 rounded shadow" },
            React.createElement("h2", { className: "text-xl font-semibold mb-2" }, "Next Team"),
            React.createElement("ul", { className: "space-y-2" },
              nextTeam.map(id => React.createElement("li", { key: id, className: "flex justify-between items-center" },
                React.createElement("span", null, getPlayerName(id)),
                React.createElement("button", { onClick: () => removeFromNextTeam(id), className: "bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600" }, "Remove")
              ))
            )
          )
        ),
        React.createElement("div", { className: "space-y-6" },
          React.createElement("div", { className: "bg-white p-4 rounded shadow" },
            React.createElement("h2", { className: "text-xl font-semibold mb-2" }, "Court A"),
            React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
              React.createElement("div", null,
                React.createElement("h3", { className: "text-lg font-semibold mb-2" }, team1Label),
                React.createElement("ul", { className: "space-y-2" },
                  team1.map(id => React.createElement("li", { key: id }, getPlayerName(id)))
                ),
                gameStartedA && team2.length > 0 && React.createElement("button", {
                  onClick: () => declareWinner("A", "Team 1"),
                  className: "mt-2 w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                }, `${team1Label} Wins`)
              ),
              React.createElement("div", null,
                React.createElement("h3", { className: "text-lg font-semibold mb-2" }, team2Label),
                React.createElement("ul", { className: "space-y-2" },
                  team2.map(id => React.createElement("li", { key: id }, getPlayerName(id)))
                ),
                gameStartedA && team2.length > 0 && React.createElement("button", {
                  onClick: () => declareWinner("A", "Team 2"),
                  className: "mt-2 w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                }, `${team2Label} Wins`)
              )
            ),
            React.createElement("div", { className: "flex justify-center space-x-4 mt-4" },
              React.createElement("button", {
                onClick: () => startFirstGame("A"),
                disabled: gameStartedA || totalCount < (gameMode === "5x5" ? 10 : 8),
                className: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400"
              }, "Start First Game: Court A"),
              React.createElement("button", {
                onClick: () => startNextGame("A"),
                disabled: totalCount < (gameMode === "5x5" ? 10 : 8) || team2.length > 0,
                className: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400"
              }, "Start Next Game: Court A")
            )
          ),
          gameMode === "4x4" && React.createElement("div", { className: "bg-white p-4 rounded shadow" },
            React.createElement("h2", { className: "text-xl font-semibold mb-2" }, "Court B"),
            React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
              React.createElement("div", null,
                React.createElement("h3", { className: "text-lg font-semibold mb-2" }, team3Label),
                React.createElement("ul", { className: "space-y-2" },
                  team3.map(id => React.createElement("li", { key: id }, getPlayerName(id)))
                ),
                gameStartedB && team4.length > 0 && React.createElement("button", {
                  onClick: () => declareWinner("B", "Team 3"),
                  className: "mt-2 w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                }, `${team3Label} Wins`)
              ),
              React.createElement("div", null,
                React.createElement("h3", { className: "text-lg font-semibold mb-2" }, team4Label),
                React.createElement("ul", { className: "space-y-2" },
                  team4.map(id => React.createElement("li", { key: id }, getPlayerName(id)))
                ),
                gameStartedB && team4.length > 0 && React.createElement("button", {
                  onClick: () => declareWinner("B", "Team 4"),
                  className: "mt-2 w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                }, `${team4Label} Wins`)
              )
            ),
            React.createElement("div", { className: "flex justify-center space-x-4 mt-4" },
              React.createElement("button", {
                onClick: () => startFirstGame("B"),
                disabled: gameStartedB || totalCount < 16,
                className: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400"
              }, "Start First Game: Court B"),
              React.createElement("button", {
                onClick: () => startNextGame("B"),
                disabled: totalCount < 16 || team4.length > 0,
                className: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400"
              }, "Start Next Game: Court B")
            )
          )
        ),
        React.createElement("div", { className: "flex flex-col items-center space-y-4" },
          React.createElement("div", { className: "flex justify-center space-x-4" },
            React.createElement("button", { onClick: clearAll, className: "bg-red-700 text-white px-4 py-2 rounded hover:bg-red-600" }, "Clear All")
          ),
          React.createElement("div", { className: "bg-white p-4 rounded shadow w-full max-w-md" },
            React.createElement("h3", { className: "text-lg font-semibold mb-2" }, `Game Mode: ${gameMode}`),
            React.createElement("div", { className: "flex space-x-2" },
              React.createElement("select", {
                value: gameMode,
                onChange: handleGameModeChange,
                className: "flex-1 p-2 border rounded"
              },
                React.createElement("option", { value: "5x5" }, "5x5"),
                React.createElement("option", { value: "4x4" }, "4x4"),
                React.createElement("option", { value: "3x3" }, "3x3")
              )
            )
          ),
          React.createElement("div", { className: "bg-white p-4 rounded shadow w-full max-w-md" },
            React.createElement("h3", { className: "text-lg font-semibold mb-2" }, `Max Wins Limit: ${maxWinsLimit}`),
            React.createElement("div", { className: "flex flex-col space-y-2" },
              React.createElement("div", { className: "flex space-x-2" },
                React.createElement("input", {
                  type: "number",
                  value: maxWinsInput,
                  onChange: (e) => { setMaxWinsInput(e.target.value); setMaxWinsError(null); },
                  placeholder: "Enter max wins",
                  className: "flex-1 p-2 border rounded"
                }),
                React.createElement("button", {
                  onClick: setMaxWins,
                  className: "bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                }, "Set")
              ),
              maxWinsError && React.createElement("p", { className: "text-red-500 text-sm" }, maxWinsError)
            )
          )
        ),
        React.createElement("div", { className: "bg-white p-4 rounded shadow" },
          React.createElement("h2", { className: "text-xl font-semibold mb-2" }, "Scoreboard"),
          React.createElement("table", { className: "w-full text-center" },
            React.createElement("thead", null,
              React.createElement("tr", { className: "bg-gray-200" },
                React.createElement("th", { className: "p-2" }, "Name"),
                React.createElement("th", { className: "p-2" }, "Wins"),
                React.createElement("th", { className: "p-2" }, "Win Streak"),
                React.createElement("th", { className: "p-2" }, "Losses")
              )
            ),
            React.createElement("tbody", null,
              players.sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase())).map(p => React.createElement("tr", {
                key: p.id,
                className: p.wins === maxWins && maxWins > 0 ? "bg-yellow-200" : ""
              },
                React.createElement("td", { className: "p-2" }, p.name),
                React.createElement("td", { className: "p-2" }, p.wins),
                React.createElement("td", { className: "p-2" }, p.winStreak),
                React.createElement("td", { className: "p-2" }, p.losses)
              ))
            )
          ),
          React.createElement("button", { onClick: clearScores, className: "mt-2 bg-red-700 text-white px-4 py-2 rounded hover:bg-red-600" }, "Clear All Scores")
        )
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  </script>
</body>
</html>
